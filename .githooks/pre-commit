#!/usr/bin/env bash
set -euo pipefail

# Allow opt-out
if [[ "${SKIP_LEDGER_VALIDATION:-}" == "1" ]]; then
  echo "[pre-commit] SKIP_LEDGER_VALIDATION=1 set; skipping ledger checks" >&2
  exit 0
fi

# Run the PowerShell validator with staged-change checks
if command -v pwsh >/dev/null 2>&1; then
  pwsh -NoProfile -File tools/validate_ledger.ps1 -CheckStaged
elif command -v powershell >/dev/null 2>&1; then
  powershell -NoProfile -File tools/validate_ledger.ps1 -CheckStaged
else
  echo "[pre-commit] No PowerShell runtime (pwsh/powershell) found to run tools/validate_ledger.ps1" >&2
  exit 1
fi

